<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finance Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {font-family: Arial, sans-serif; margin:0; background:#f4f6f9;}
    .login-container, .dashboard {display:none; padding:20px;}
    .active {display:block;}
    .card {background:#fff; border-radius:12px; padding:20px; margin:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    .flex {display:flex; gap:20px; flex-wrap:wrap;}
    .balance {flex:1; text-align:center; font-size:20px; font-weight:bold;}
    .sidebar {width:220px; background:#2c3e50; color:white; position:fixed; top:0; bottom:0; padding:20px;}
    .sidebar h2 {margin-top:0;}
    .sidebar button {display:block; margin:10px 0; padding:10px; width:100%; border:none; border-radius:6px; background:#34495e; color:white; cursor:pointer;}
    .content {margin-left:240px; padding:20px;}
    table {width:100%; border-collapse:collapse; margin-top:20px; background:#fff;}
    th, td {border:1px solid #ddd; padding:8px; text-align:center;}
    th {background:#34495e; color:white;}
    input, select {padding:8px; margin:5px; border:1px solid #ccc; border-radius:6px;}
    button.primary {background:#3498db; color:white; padding:10px 15px; border:none; border-radius:6px; cursor:pointer;}
    .actions button {margin:2px; padding:5px 8px; border:none; border-radius:4px; cursor:pointer;}
    .edit {background:#f39c12; color:white;}
    .delete {background:#e74c3c; color:white;}
    .export {background:#2ecc71; color:white;}
  </style>
</head>
<body><!-- Login Page --><div class="login-container active" id="loginPage">
  <h2>Login</h2>
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button class="primary" onclick="login()">Login</button>
  <button onclick="signup()">Sign Up</button>
</div><!-- Dashboard Page --><div class="dashboard" id="dashboardPage">
  <div class="sidebar">
    <h2>Dashboard</h2>
    <button onclick="showSection('balances')">Balances</button>
    <button onclick="showSection('transactionForm')">New Transaction</button>
    <button onclick="showSection('journal')">Journal</button>
    <button onclick="showSection('ledger')">Ledger</button>
    <button onclick="showSection('chart')">Summary Chart</button>
    <button onclick="logout()">Logout</button>
  </div>  <div class="content">
    <!-- Balance Section -->
    <div id="balances" class="section">
      <div class="flex">
        <div class="card balance" id="cashBalance">Cash: Rs 0</div>
        <div class="card balance" id="bankBalance">Bank: Rs 0</div>
        <div class="card balance" id="esewaBalance">eSewa: Rs 0</div>
        <div class="card balance" id="totalBalance">Total: Rs 0</div>
      </div>
    </div><!-- Transaction Form -->
<div id="transactionForm" class="section" style="display:none;">
  <h3>New Transaction</h3>
  <input type="text" id="txnName" placeholder="Transaction Name"><br>
  <select id="txnType">
    <option value="Cash">Cash</option>
    <option value="Bank">Bank</option>
    <option value="eSewa">eSewa</option>
  </select>
  <select id="txnCategory">
    <option value="Income">Income</option>
    <option value="Expense">Expense</option>
  </select>
  <input type="number" id="txnAmount" placeholder="Amount (Rs)"><br>
  <button class="primary" onclick="saveTransaction()">Save Transaction</button>
</div>

<!-- Journal Section -->
<div id="journal" class="section" style="display:none;">
  <h3>Journal</h3>
  <input type="text" id="searchBox" placeholder="Search by name..." onkeyup="renderTransactions()">
  <button class="export" onclick="exportPDF(transactions, 'transactions.pdf')">Export PDF</button>
  <button class="export" onclick="exportCSV(transactions, 'transactions.csv')">Export CSV</button>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Name</th>
        <th>Type</th>
        <th>Category</th>
        <th>Amount</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="txnTable"></tbody>
  </table>
</div>

<!-- Ledger Section -->
<div id="ledger" class="section" style="display:none;">
  <h3>Ledger</h3>
  <div id="ledgerContent"></div>
</div>

<!-- Chart Section -->
<div id="chart" class="section" style="display:none;">
  <h3>Monthly Income vs Expense</h3>
  <canvas id="summaryChart"></canvas>
</div>

  </div>
</div><script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBgScLw0UPPs0t2KYulnCAIcvk6vw6ay18",
  authDomain: "data-d6493.firebaseapp.com",
  projectId: "data-d6493",
  storageBucket: "data-d6493.firebasestorage.app",
  messagingSenderId: "628882897413",
  appId: "1:628882897413:web:a2f4bd770457c71a427a6c",
  measurementId: "G-WE23QDWD33"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// UI Switch
function showSection(id){
  document.querySelectorAll('.section').forEach(s => s.style.display='none');
  document.getElementById(id).style.display='block';
}

// Auth
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value).then(()=>{
    loginPage.classList.remove('active');
    dashboardPage.classList.add('active');
    loadTransactions();
  }).catch(alert);
}
function signup(){
  auth.createUserWithEmailAndPassword(email.value,password.value).then(()=>alert("User Created"))
  .catch(alert);
}
function logout(){auth.signOut().then(()=>location.reload());}

// Transactions
let transactions = [];
function saveTransaction(){
  const txn={
    name:txnName.value,
    type:txnType.value,
    category:txnCategory.value,
    amount:parseFloat(txnAmount.value),
    date:new Date().toISOString()
  };
  db.collection('transactions').add(txn);
  txnName.value=''; txnAmount.value='';
}

function loadTransactions(){
  db.collection('transactions').orderBy('date','desc').onSnapshot(snap=>{
    transactions=snap.docs.map(doc=>({id:doc.id,...doc.data()}));
    renderTransactions();
    updateBalances();
    updateChart();
    renderLedger();
  });
}

function renderTransactions(){
  const tbody=document.getElementById('txnTable');
  tbody.innerHTML='';
  let search=searchBox.value.toLowerCase();
  transactions.filter(t=>t.name.toLowerCase().includes(search)).forEach(t=>{
    let tr=document.createElement('tr');
    tr.innerHTML=`<td>${new Date(t.date).toLocaleDateString()}</td>
    <td>${t.name}</td><td>${t.type}</td><td>${t.category}</td><td>Rs ${t.amount}</td>
    <td class='actions'><button class='edit' onclick="editTxn('${t.id}')">Edit</button>
    <button class='delete' onclick="deleteTxn('${t.id}')">Delete</button></td>`;
    tbody.appendChild(tr);
  });
}

function editTxn(id){
  const t=transactions.find(x=>x.id===id);
  txnName.value=t.name; txnType.value=t.type; txnCategory.value=t.category; txnAmount.value=t.amount;
  deleteTxn(id);
  showSection('transactionForm');
}
function deleteTxn(id){db.collection('transactions').doc(id).delete();}

// Balances
function updateBalances(){
  let cash=0,bank=0,esewa=0;
  transactions.forEach(t=>{
    let amt=(t.category==='Income'?t.amount:-t.amount);
    if(t.type==='Cash')cash+=amt;
    if(t.type==='Bank')bank+=amt;
    if(t.type==='eSewa')esewa+=amt;
  });
  cashBalance.innerText=`Cash: Rs ${cash}`;
  bankBalance.innerText=`Bank: Rs ${bank}`;
  esewaBalance.innerText=`eSewa: Rs ${esewa}`;
  totalBalance.innerText=`Total: Rs ${cash+bank+esewa}`;
}

// Ledger
function renderLedger(){
  const accounts=['Cash','Bank','eSewa'];
  const ledgerDiv=document.getElementById('ledgerContent');
  ledgerDiv.innerHTML='';
  accounts.forEach(acc=>{
    let accTxns=transactions.filter(t=>t.type===acc);
    if(accTxns.length>0){
      let div=document.createElement('div');
      div.innerHTML=`<h4>${acc} Ledger</h4>
      <button class='export' onclick="exportPDF(${JSON.stringify(accTxns)}, '${acc}_ledger.pdf')">PDF</button>
      <button class='export' onclick="exportCSV(${JSON.stringify(accTxns)}, '${acc}_ledger.csv')">CSV</button>
      <table><thead><tr><th>Date</th><th>Name</th><th>Category</th><th>Amount</th></tr></thead><tbody>
      ${accTxns.map(t=>`<tr><td>${new Date(t.date).toLocaleDateString()}</td><td>${t.name}</td><td>${t.category}</td><td>Rs ${t.amount}</td></tr>`).join('')}
      </tbody></table>`;
      ledgerDiv.appendChild(div);
    }
  });
}

// Chart
let chart;
function updateChart(){
  let months={}, labels=[], income=[], expense=[];
  transactions.forEach(t=>{
    let m=new Date(t.date).toLocaleString('default',{month:'short',year:'numeric'});
    if(!months[m])months[m]={income:0,expense:0};
    if(t.category==='Income')months[m].income+=t.amount; else months[m].expense+=t.amount;
  });
  labels=Object.keys(months);
  income=labels.map(l=>months[l].income);
  expense=labels.map(l=>months[l].expense);
  if(chart) chart.destroy();
  chart=new Chart(summaryChart,{type:'bar',data:{labels,datasets:[{label:'Income',data:income,backgroundColor:'green'},{label:'Expense',data:expense,backgroundColor:'red'}]}});
}

// Export PDF
function exportPDF(data, filename){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("Transactions",10,10);
  let y=20;
  data.forEach(t=>{
    doc.text(`${new Date(t.date).toLocaleDateString()} - ${t.name} - ${t.type||''} - ${t.category} - Rs ${t.amount}`,10,y);
    y+=10;
    if(y>280){doc.addPage();y=20;}
  });
  doc.save(filename);
}

// Export CSV
function exportCSV(data, filename){
  let csv="Date,Name,Type,Category,Amount\n";
  data.forEach(t=>{
    csv+=`${new Date(t.date).toLocaleDateString()},${t.name},${t.type||''},${t.category},${t.amount}\n`;
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=filename;
  a.click();
}
</script></body>
</html>
