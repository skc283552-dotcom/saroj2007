<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Accounting System</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<!-- jsPDF & AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
:root {
    --primary-color: #3498db;
    --secondary-color: #2ecc71;
    --accent-color: #e74c3c;
    --dark-color: #2c3e50;
    --light-color: #ecf0f1;
    --sidebar-width: 250px;
}
* { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background-color:#f5f7fa; color:#333; }

/* Login Page */
#login-page { height:100vh; display:flex; justify-content:center; align-items:center; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); }
.login-container { background:white; padding:2rem; border-radius:10px; box-shadow:0 10px 25px rgba(0,0,0,0.2); width:100%; max-width:400px; }
.login-container h1 { text-align:center; margin-bottom:1.5rem; color:var(--primary-color); font-weight:700; }
.form-group { margin-bottom:1.5rem; }
.form-group label { display:block; margin-bottom:0.5rem; font-weight:600; color:var(--dark-color); }
.form-group input, select { width:100%; padding:0.75rem; border:1px solid #ddd; border-radius:5px; font-size:1rem; }
button { width:100%; padding:0.75rem; background-color:var(--primary-color); color:white; border:none; border-radius:5px; font-size:1rem; font-weight:600; cursor:pointer; transition:background-color 0.3s; }
button:hover { background-color:#2980b9; }

/* Dashboard */
#dashboard { display:none; min-height:100vh; }
.sidebar { position:fixed; width:var(--sidebar-width); height:100vh; background-color:var(--dark-color); color:white; padding:1rem 0; overflow-y:auto; }
.sidebar-header { padding:0 1.5rem 1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); }
.sidebar-header h2 { color:white; font-size:1.5rem; }
.sidebar-menu { list-style:none; padding:1.5rem 0; }
.sidebar-menu li { padding:0.75rem 1.5rem; cursor:pointer; transition:background-color 0.3s; display:flex; align-items:center; }
.sidebar-menu li:hover { background-color: rgba(255,255,255,0.1); }
.sidebar-menu li.active { background-color: var(--primary-color); }
.sidebar-menu li i { margin-right:0.75rem; font-size:1.25rem; }
.main-content { margin-left:var(--sidebar-width); padding:2rem; }
.content-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; }
.search-bar { display:flex; align-items:center; }
.search-bar input { padding:0.75rem; border:1px solid #ddd; border-radius:5px; width:300px; margin-right:1rem; }
.card { background:white; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1); padding:1.5rem; margin-bottom:2rem; }
.card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; padding-bottom:0.75rem; border-bottom:1px solid #eee; }
.card-header h3 { color:var(--dark-color); }
.form-row { display:flex; flex-wrap:wrap; margin:0 -0.75rem; }
.form-col { flex:1 0 250px; padding:0 0.75rem; margin-bottom:1rem; }
table { width:100%; border-collapse:collapse; }
table th, table td { padding:0.75rem; text-align:left; border-bottom:1px solid #eee; }
table th { background-color:#f8f9fa; font-weight:600; }
.action-buttons button { width:auto; padding:0.25rem 0.75rem; margin-right:0.5rem; }
.btn-edit { background-color:#f39c12; color:white; border:none; border-radius:4px; cursor:pointer; }
.btn-delete { background-color:var(--accent-color); color:white; border:none; border-radius:4px; cursor:pointer; }
.summary-cards { display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:1.5rem; margin-bottom:2rem; }
.summary-card { background:white; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1); padding:1.5rem; text-align:center; }
.summary-card h3 { font-size:1rem; margin-bottom:0.5rem; color:var(--dark-color); }
.summary-card .amount { font-size:1.5rem; font-weight:700; }
.cash { color:#27ae60; } .bank { color:#3498db; } .esewa { color:#9b59b6; } .debtors { color:#f39c12; } .creditors { color:#e74c3c; }

/* Modal */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
.modal-content { background:white; border-radius:10px; width:100%; max-width:500px; padding:2rem; }
.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; }
.close-modal { background:none; border:none; font-size:1.5rem; cursor:pointer; color:#999; }

.content-section { display:none; }
.content-section.active { display:block; }
</style>
</head>
<body>

<!-- Login Page -->
<div id="login-page">
    <div class="login-container">
        <h1>Accounting System</h1>
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="Enter your email">
        </div>
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" placeholder="Enter your password">
        </div>
        <button id="login-btn">Login (Demo)</button>
    </div>
</div>

<!-- Dashboard -->
<div id="dashboard">
    <div class="sidebar">
        <div class="sidebar-header"><h2>Accounting</h2></div>
        <ul class="sidebar-menu">
            <li class="active" data-target="dashboard-info"><i>üìä</i> Dashboard</li>
            <li data-target="new-transaction"><i>üíº</i> New Transaction</li>
            <li data-target="journal"><i>üìí</i> Journal</li>
            <li data-target="ledger"><i>üìä</i> Ledger</li>
            <li data-target="debtors"><i>üë§</i> Debtors</li>
            <li data-target="creditors"><i>üè¢</i> Creditors</li>
            <li data-target="pdf-download"><i>üì•</i> PDF Download</li>
            <li id="logout-btn"><i>üö™</i> Logout</li>
        </ul>
    </div>

    <div class="main-content">

        <!-- Dashboard Info -->
        <div id="dashboard-info" class="content-section active">
            <div class="content-header">
                <h1>Dashboard</h1>
            </div>

            <div class="summary-cards">
                <div class="summary-card"><h3>Cash Balance</h3><div class="amount cash">‚Çπ<span id="cash-balance">0.00</span></div></div>
                <div class="summary-card"><h3>Bank Balance</h3><div class="amount bank">‚Çπ<span id="bank-balance">0.00</span></div></div>
                <div class="summary-card"><h3>eSewa Balance</h3><div class="amount esewa">‚Çπ<span id="esewa-balance">0.00</span></div></div>
                <div class="summary-card"><h3>Total Debtors</h3><div class="amount debtors">‚Çπ<span id="debtors-total">0.00</span></div></div>
                <div class="summary-card"><h3>Total Creditors</h3><div class="amount creditors">‚Çπ<span id="creditors-total">0.00</span></div></div>
            </div>
        </div>

        <!-- New Transaction -->
        <div id="new-transaction" class="content-section">
            <div class="card">
                <div class="card-header"><h3>New Transaction</h3></div>
                <form id="transaction-form">
                    <div class="form-row">
                        <div class="form-col">
                            <label for="account-name">Account Name</label>
                            <input type="text" id="account-name" required>
                        </div>
                        <div class="form-col">
                            <label for="details">Details</label>
                            <input type="text" id="details" required>
                        </div>
                        <div class="form-col">
                            <label for="payment-type">Payment Type</label>
                            <select id="payment-type">
                                <option value="cash">Cash</option>
                                <option value="bank">Bank</option>
                                <option value="esewa">eSewa</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="transaction-type">Transaction Type</label>
                            <select id="transaction-type">
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="amount">Amount</label>
                            <input type="number" id="amount" step="0.01" required>
                        </div>
                        <div class="form-col">
                            <label for="date">Date</label>
                            <input type="date" id="date" required>
                        </div>
                        <div class="form-col" style="flex:1 0 100%; text-align:right;">
                            <button type="submit">Add Transaction</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Journal -->
        <div id="journal" class="content-section">
            <div class="card">
                <div class="card-header"><h3>Journal</h3></div>
                <table>
                    <thead>
                        <tr><th>Date</th><th>Account</th><th>Details</th><th>Payment</th><th>Type</th><th>Amount</th><th>Action</th></tr>
                    </thead>
                    <tbody id="journal-entries"></tbody>
                </table>
            </div>
        </div>

        <!-- Ledger -->
        <div id="ledger" class="content-section">
            <div class="card">
                <div class="card-header"><h3>Ledger</h3>
                    <select id="ledger-account"></select>
                </div>
                <table>
                    <thead><tr><th>Date</th><th>Details</th><th>Payment</th><th>Debit</th><th>Credit</th><th>Balance</th></tr></thead>
                    <tbody id="ledger-entries"></tbody>
                </table>
            </div>
        </div>

        <!-- Debtors -->
        <div id="debtors" class="content-section">
            <div class="card">
                <div class="card-header"><h3>Debtors</h3></div>
                <table>
                    <thead><tr><th>Account</th><th>Amount</th></tr></thead>
                    <tbody id="debtors-table"></tbody>
                </table>
            </div>
        </div>

        <!-- Creditors -->
        <div id="creditors" class="content-section">
            <div class="card">
                <div class="card-header"><h3>Creditors</h3></div>
                <table>
                    <thead><tr><th>Account</th><th>Amount</th></tr></thead>
                    <tbody id="creditors-table"></tbody>
                </table>
            </div>
        </div>

        <!-- PDF Download -->
        <div id="pdf-download" class="content-section">
            <div class="card">
                <div class="card-header"><h3>Download PDF</h3></div>
                <button id="download-pdf-btn">Download Accounting PDF</button>
            </div>
        </div>

    </div>
</div>

<!-- Edit Modal -->
<div class="modal" id="edit-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit Transaction</h3>
            <button class="close-modal" id="close-edit">&times;</button>
        </div>
        <form id="edit-form">
            <input type="hidden" id="edit-id">
            <div class="form-row">
                <div class="form-col"><label>Account</label><input type="text" id="edit-account-name" required></div>
                <div class="form-col"><label>Details</label><input type="text" id="edit-details" required></div>
                <div class="form-col"><label>Payment Type</label><select id="edit-payment-type"><option value="cash">Cash</option><option value="bank">Bank</option><option value="esewa">eSewa</option></select></div>
                <div class="form-col"><label>Transaction Type</label><select id="edit-transaction-type"><option value="income">Income</option><option value="expense">Expense</option></select></div>
                <div class="form-col"><label>Amount</label><input type="number" id="edit-amount" step="0.01" required></div>
                <div class="form-col"><label>Date</label><input type="date" id="edit-date" required></div>
                <div class="form-col" style="flex:1 0 100%; text-align:right;"><button type="submit">Save Changes</button></div>
            </div>
        </form>
    </div>
</div>

<script>
// Firebase setup
const firebaseConfig = {
  apiKey: "AIzaSyBgScLw0UPPs0t2KYulnCAIcvk6vw6ay18",
  authDomain: "data-d6493.firebaseapp.com",
  databaseURL: "https://data-d6493-default-rtdb.firebaseio.com",
  projectId: "data-d6493",
  storageBucket: "data-d6493.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:abcdef123456"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let transactions = [];

// Login Demo
document.getElementById('login-btn').addEventListener('click', () => {
    document.getElementById('login-page').style.display='none';
    document.getElementById('dashboard').style.display='block';
});

// Sidebar navigation
document.querySelectorAll('.sidebar-menu li[data-target]').forEach(item => {
    item.addEventListener('click', () => {
        document.querySelectorAll('.sidebar-menu li').forEach(i=>i.classList.remove('active'));
        item.classList.add('active');
        document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
        document.getElementById(item.dataset.target).classList.add('active');
        if(item.dataset.target==='ledger') displayLedger();
    });
});
document.getElementById('logout-btn').addEventListener('click',()=>location.reload());

// Add Transaction
document.getElementById('transaction-form').addEventListener('submit',e=>{
    e.preventDefault();
    const t = {
        id: Date.now(),
        accountName: document.getElementById('account-name').value.trim(),
        details: document.getElementById('details').value.trim(),
        paymentType: document.getElementById('payment-type').value,
        transactionType: document.getElementById('transaction-type').value,
        amount: parseFloat(document.getElementById('amount').value),
        date: document.getElementById('date').value
    };
    db.ref('transactions/'+t.id).set(t,err=>{
        if(!err) document.getElementById('transaction-form').reset();
    });
});

// Real-time listener
db.ref('transactions').on('value', snap=>{
    transactions = [];
    snap.forEach(child=>transactions.push(child.val()));
    updateDashboard();
    updateJournal();
    updateAccounts();
    displayLedger();
    updateDebtorsCreditors();
});

// Dashboard update
function updateDashboard() {
    const cash = transactions.filter(t=>t.paymentType==='cash').reduce((a,b)=>a+(b.transactionType==='income'?b.amount:-b.amount),0);
    const bank = transactions.filter(t=>t.paymentType==='bank').reduce((a,b)=>a+(b.transactionType==='income'?b.amount:-b.amount),0);
    const esewa = transactions.filter(t=>t.paymentType==='esewa').reduce((a,b)=>a+(b.transactionType==='income'?b.amount:-b.amount),0);
    const debtors = transactions.filter(t=>t.transactionType==='income').reduce((a,b)=>a+b.amount,0);
    const creditors = transactions.filter(t=>t.transactionType==='expense').reduce((a,b)=>a+b.amount,0);
    document.getElementById('cash-balance').textContent = cash.toFixed(2);
    document.getElementById('bank-balance').textContent = bank.toFixed(2);
    document.getElementById('esewa-balance').textContent = esewa.toFixed(2);
    document.getElementById('debtors-total').textContent = debtors.toFixed(2);
    document.getElementById('creditors-total').textContent = creditors.toFixed(2);
}

// Journal
function updateJournal() {
    const tbody = document.getElementById('journal-entries');
    tbody.innerHTML = transactions.length ? transactions.map(t=>`<tr>
        <td>${t.date}</td><td>${t.accountName}</td><td>${t.details}</td><td>${t.paymentType}</td>
        <td>${t.transactionType}</td><td>‚Çπ${t.amount.toFixed(2)}</td>
        <td class="action-buttons">
            <button class="btn-edit" onclick="openEditModal(${t.id})">Edit</button>
            <button class="btn-delete" onclick="deleteTransaction(${t.id})">Delete</button>
        </td>
    </tr>`).join('') : '<tr><td colspan="7" style="text-align:center;">No transactions yet</td></tr>';
}

// Edit
function openEditModal(id){
    const t = transactions.find(x=>x.id===id);
    if(!t) return;
    document.getElementById('edit-id').value = t.id;
    document.getElementById('edit-account-name').value=t.accountName;
    document.getElementById('edit-details').value=t.details;
    document.getElementById('edit-payment-type').value=t.paymentType;
    document.getElementById('edit-transaction-type').value=t.transactionType;
    document.getElementById('edit-amount').value=t.amount;
    document.getElementById('edit-date').value=t.date;
    document.getElementById('edit-modal').style.display='flex';
}
document.getElementById('edit-form').addEventListener('submit',e=>{
    e.preventDefault();
    const id = parseInt(document.getElementById('edit-id').value);
    const t = transactions.find(x=>x.id===id);
    if(!t) return;
    t.accountName=document.getElementById('edit-account-name').value;
    t.details=document.getElementById('edit-details').value;
    t.paymentType=document.getElementById('edit-payment-type').value;
    t.transactionType=document.getElementById('edit-transaction-type').value;
    t.amount=parseFloat(document.getElementById('edit-amount').value);
    t.date=document.getElementById('edit-date').value;
    db.ref('transactions/'+id).set(t,()=>document.getElementById('edit-modal').style.display='none');
});
document.getElementById('close-edit').addEventListener('click',()=>document.getElementById('edit-modal').style.display='none');

// Delete
function deleteTransaction(id){ if(confirm('Are you sure to delete?')) db.ref('transactions/'+id).remove(); }

// Ledger
const ledgerAccountSelect = document.getElementById('ledger-account');
ledgerAccountSelect.addEventListener('change', displayLedger);
function updateAccounts(){
    const accounts = [...new Set(transactions.map(t=>t.accountName))].filter(Boolean);
    ledgerAccountSelect.innerHTML='<option value="">Select Account</option>';
    accounts.forEach(a=>ledgerAccountSelect.innerHTML+=`<option value="${a}">${a}</option>`);
}
function displayLedger(){
    const account = ledgerAccountSelect.value;
    const tbody = document.getElementById('ledger-entries');
    tbody.innerHTML='';
    if(!account){ tbody.innerHTML='<tr><td colspan="6" style="text-align:center;">Select an account to view ledger</td></tr>'; return; }
    let balance=0;
    const list = transactions.filter(t=>t.accountName===account);
    if(!list.length){ tbody.innerHTML='<tr><td colspan="6" style="text-align:center;">No transactions</td></tr>'; return; }
    list.forEach(t=>{
        balance += t.transactionType==='income'? t.amount: -t.amount;
        tbody.innerHTML += `<tr>
            <td>${t.date}</td><td>${t.details}</td><td>${t.paymentType}</td>
            <td>${t.transactionType==='income'?`‚Çπ${t.amount.toFixed(2)}`:''}</td>
            <td>${t.transactionType==='expense'?`‚Çπ${t.amount.toFixed(2)}`:''}</td>
            <td>‚Çπ${balance.toFixed(2)}</td>
        </tr>`;
    });
}

// Debtors & Creditors
function updateDebtorsCreditors(){
    const debtorsTable = document.getElementById('debtors-table');
    const creditorsTable = document.getElementById('creditors-table');
    const debtorsList = transactions.filter(t=>t.transactionType==='income');
    const creditorsList = transactions.filter(t=>t.transactionType==='expense');
    debtorsTable.innerHTML = debtorsList.length ? debtorsList.map(t=>`<tr><td>${t.accountName}</td><td>‚Çπ${t.amount.toFixed(2)}</td></tr>`).join('') : '<tr><td colspan="2" style="text-align:center;">No debtors</td></tr>';
    creditorsTable.innerHTML = creditorsList.length ? creditorsList.map(t=>`<tr><td>${t.accountName}</td><td>‚Çπ${t.amount.toFixed(2)}</td></tr>`).join('') : '<tr><td colspan="2" style="text-align:center;">No creditors</td></tr>';
}

// PDF Download
document.getElementById('download-pdf-btn').addEventListener('click',()=>{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let y=10;

    doc.setFontSize(16); doc.text("Accounting Report",105,y,null,'center'); y+=10;

    // Transactions
    doc.setFontSize(12); doc.text("All Transactions",10,y); y+=6;
    doc.autoTable({ startY:y, head:[['Date','Account','Details','Payment','Type','Amount']], body: transactions.map(t=>[t.date,t.accountName,t.details,t.paymentType,t.transactionType,`‚Çπ${t.amount.toFixed(2)}`]), theme:'grid' });
    y=doc.lastAutoTable.finalY+10;

    // Ledger per account
    const accounts = [...new Set(transactions.map(t=>t.accountName))];
    accounts.forEach(acc=>{
        doc.text(`Ledger: ${acc}`,10,y); y+=6;
        const list = transactions.filter(t=>t.accountName===acc);
        let balance=0;
        const body = list.map(t=>{
            balance += t.transactionType==='income'? t.amount: -t.amount;
            return [t.date,t.details,t.paymentType,t.transactionType==='income'?`‚Çπ${t.amount.toFixed(2)}`:'',t.transactionType==='expense'?`‚Çπ${t.amount.toFixed(2)}`:'',`‚Çπ${balance.toFixed(2)}`];
        });
        doc.autoTable({ startY:y, head:[['Date','Details','Payment','Debit','Credit','Balance']], body, theme:'grid' });
        y=doc.lastAutoTable.finalY+10;
    });

    // Debtors
    const debtorsList = transactions.filter(t=>t.transactionType==='income');
    if(debtorsList.length){
        doc.text("Debtors",10,y); y+=6;
        doc.autoTable({ startY:y, head:[['Account','Amount']], body:debtorsList.map(t=>[t.accountName,`‚Çπ${t.amount.toFixed(2)}`]), theme:'grid' });
        y=doc.lastAutoTable.finalY+10;
    }

    // Creditors
    const creditorsList = transactions.filter(t=>t.transactionType==='expense');
    if(creditorsList.length){
        doc.text("Creditors",10,y); y+=6;
        doc.autoTable({ startY:y, head:[['Account','Amount']], body:creditorsList.map(t=>[t.accountName,`‚Çπ${t.amount.toFixed(2)}`]), theme:'grid' });
    }

    doc.save('Accounting_Report.pdf');
});
</script>
</body>
</html>
