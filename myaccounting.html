<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Accounting Pro</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f6f9; }
header { background:#2c3e50; color:#fff; text-align:center; padding:15px; font-size:24px; font-weight:bold; }
.dashboard { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin:20px; }
.icon { background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.2); padding:20px; width:150px; text-align:center; cursor:pointer; transition:.3s; }
.icon:hover { background:#3498db; color:#fff; }
.icon span { font-size:40px; display:block; }
section { margin:20px; background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); display:none; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
table, th, td { border:1px solid #ccc; }
th, td { padding:8px; text-align:center; }
button { padding:6px 12px; margin:2px; border:none; border-radius:6px; cursor:pointer; }
.edit { background:#f39c12; color:#fff; }
.delete { background:#e74c3c; color:#fff; }
.save { background:#27ae60; color:#fff; }
.balanceBox { display:flex; gap:20px; justify-content:center; margin:20px; }
.balanceCard { background:#fff; padding:15px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-align:center; width:150px; }
input, select { padding:6px; margin:4px; width:150px; }
</style>
</head>
<body>

<header>üìä My Accounting Pro</header>

<div class="dashboard" id="dashboard">
  <div class="icon" onclick="showSection('addTransaction')"><span>‚ûï</span>Add Transaction</div>
  <div class="icon" onclick="showSection('ledger')"><span>üìí</span>Ledger</div>
  <div class="icon" onclick="showSection('journal')"><span>üìù</span>Journal</div>
  <div class="icon" onclick="showSection('allTransactions')"><span>üìÇ</span>All Transactions</div>
  <div class="icon" onclick="downloadPDF()"><span>üìë</span>Download PDF</div>
</div>

<div class="balanceBox">
  <div class="balanceCard"><h3>Cash</h3><p id="cashBalance">0</p></div>
  <div class="balanceCard"><h3>Bank</h3><p id="bankBalance">0</p></div>
  <div class="balanceCard"><h3>eSewa</h3><p id="esewaBalance">0</p></div>
  <div class="balanceCard"><h3>Total</h3><p id="totalBalance">0</p></div>
</div>

<section id="addTransaction">
  <h2>Add Transaction</h2>
  <input type="text" id="tname" placeholder="Name">
  <input type="number" id="tamount" placeholder="Amount">
  <select id="ttype">
    <option value="Cash">Cash</option>
    <option value="Bank">Bank</option>
    <option value="eSewa">eSewa</option>
  </select>
  <select id="ttCategory">
    <option value="Income">Income</option>
    <option value="Expense">Expense</option>
  </select>
  <input type="text" id="tdesc" placeholder="Description">
  <input type="date" id="tdate">
  <button class="save" onclick="addTransaction()">Save</button>
  <button onclick="showSection('dashboard')">‚¨Ö Back</button>
</section>

<section id="ledger">
  <h2>Ledger</h2>
  <input type="text" id="searchLedger" placeholder="Search by Name">
  <input type="date" id="searchLedgerDate">
  <button onclick="searchLedgerFn()">Search</button>
  <div id="ledgerData"></div>
  <button onclick="showSection('dashboard')">‚¨Ö Back</button>
</section>

<section id="journal">
  <h2>Journal</h2>
  <div id="journalData"></div>
  <button onclick="showSection('dashboard')">‚¨Ö Back</button>
</section>

<section id="allTransactions">
  <h2>All Transactions</h2>
  <div id="allData"></div>
  <button onclick="showSection('dashboard')">‚¨Ö Back</button>
</section>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function showSection(id){
  document.querySelectorAll('section').forEach(s=>s.style.display='none');
  if(id==='dashboard'){ document.getElementById('dashboard').style.display='flex'; }
  else{ document.getElementById('dashboard').style.display='none'; document.getElementById(id).style.display='block'; }
}

// Add Transaction
function addTransaction(){
  const name=document.getElementById('tname').value;
  const amount=parseFloat(document.getElementById('tamount').value);
  const type=document.getElementById('ttype').value;
  const category=document.getElementById('ttCategory').value;
  const desc=document.getElementById('tdesc').value;
  const date=document.getElementById('tdate').value || new Date().toLocaleDateString();
  if(!name || !amount){ alert('Fill all fields'); return; }
  const newRef=db.ref('transactions').push();
  newRef.set({id:newRef.key, name, amount, type, category, desc, date});
  document.getElementById('tname').value=''; document.getElementById('tamount').value=''; document.getElementById('tdesc').value=''; document.getElementById('tdate').value='';
}

// Render Data with Remaining Balance
db.ref('transactions').on('value', snapshot=>{
  const data=snapshot.val()||{};
  let ledgerHTML="<table><tr><th>Name</th><th>Amount</th><th>Category</th><th>Type</th><th>Description</th><th>Date</th><th>Balance</th><th>Action</th></tr>";
  let journalHTML="<table><tr><th>Date</th><th>Name</th><th>Category</th><th>Type</th><th>Description</th><th>Amount</th></tr>";
  let allHTML=ledgerHTML;

  let balances={Cash:0, Bank:0, eSewa:0};

  for(let id in data){
    const t=data[id];
    const amt=(t.category==='Income'? t.amount : -t.amount);
    balances[t.type]+=amt;

    const totalBalance=balances.Cash + balances.Bank + balances.eSewa;

    ledgerHTML+=`<tr>
      <td>${t.name}</td><td>${t.amount}</td><td>${t.category}</td><td>${t.type}</td><td>${t.desc}</td><td>${t.date}</td><td>${totalBalance}</td>
      <td>
        <button class='edit' onclick="editTransaction('${id}')">Edit</button>
        <button class='delete' onclick="deleteTransaction('${id}')">Delete</button>
      </td>
    </tr>`;
    journalHTML+=`<tr><td>${t.date}</td><td>${t.name}</td><td>${t.category}</td><td>${t.type}</td><td>${t.desc}</td><td>${t.amount}</td></tr>`;
    allHTML+=`<tr>
      <td>${t.name}</td><td>${t.amount}</td><td>${t.category}</td><td>${t.type}</td><td>${t.desc}</td><td>${t.date}</td>
      <td>${totalBalance}</td>
      <td>
        <button class='edit' onclick="editTransaction('${id}')">Edit</button>
        <button class='delete' onclick="deleteTransaction('${id}')">Delete</button>
      </td>
    </tr>`;
  }

  ledgerHTML+="</table>"; journalHTML+="</table>"; allHTML+="</table>";
  document.getElementById('ledgerData').innerHTML=ledgerHTML;
  document.getElementById('journalData').innerHTML=journalHTML;
  document.getElementById('allData').innerHTML=allHTML;

  document.getElementById('cashBalance').innerText=balances.Cash;
  document.getElementById('bankBalance').innerText=balances.Bank;
  document.getElementById('esewaBalance').innerText=balances.eSewa;
  document.getElementById('totalBalance').innerText=balances.Cash + balances.Bank + balances.eSewa;
});

// Delete
function deleteTransaction(id){ if(confirm('Delete?')) db.ref('transactions/'+id).remove(); }

// Edit
function editTransaction(id){
  db.ref('transactions/'+id).once('value',snap=>{
    const t=snap.val();
    const name=prompt("Edit Name", t.name);
    const amount=parseFloat(prompt("Edit Amount", t.amount));
    const type=prompt("Edit Type (Cash/Bank/eSewa)", t.type);
    const category=prompt("Edit Category (Income/Expense)", t.category);
    const desc=prompt("Edit Description", t.desc);
    const date=prompt("Edit Date (YYYY-MM-DD)", t.date);
    if(name && !isNaN(amount) && type && desc && category && date){
      db.ref('transactions/'+id).update({name, amount, type, desc, date, category});
    }
  });
}

// Search Ledger by Name or Date
function searchLedgerFn(){
  const name=document.getElementById('searchLedger').value.toLowerCase();
  const date=document.getElementById('searchLedgerDate').value;
  db.ref('transactions').once('value',snap=>{
    const data=snap.val()||{};
    let html="<table><tr><th>Name</th><th>Amount</th><th>Category</th><th>Type</th><th>Description</th><th>Date</th><th>Balance</th></tr>";
    let balances={Cash:0, Bank:0, eSewa:0};
    for(let id in data){
      const t=data[id];
      if((!name || t.name.toLowerCase().includes(name)) && (!date || t.date===date)){
        const amt=(t.category==='Income'? t.amount : -t.amount);
        balances[t.type]+=amt;
        const totalBalance=balances.Cash+balances.Bank+balances.eSewa;
        html+=`<tr>
          <td>${t.name}</td><td>${t.amount}</td><td>${t.category}</td><td>${t.type}</td><td>${t.desc}</td><td>${t.date}</td><td>${totalBalance}</td>
        </tr>`;
      }
    }
    html+="</table>";
    document.getElementById('ledgerData').innerHTML=html;
  });
}

// PDF
function downloadPDF(){
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();
  doc.text("My Accounting Transactions",20,20);
  let y=30;
  db.ref('transactions').once('value',snap=>{
    const data=snap.val()||{};
    for(let id in data){
      const t=data[id];
      doc.text(`${t.date} | ${t.name} | ${t.category} | ${t.type} | ${t.amount} | ${t.desc}`,20,y); y+=10;
    }
    doc.save("transactions.pdf");
  });
}
</script>
</body>
</html>
