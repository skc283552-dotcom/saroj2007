<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Accounting Pro</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f6f9; }
header { background:#2c3e50; color:#fff; text-align:center; padding:15px; font-size:24px; font-weight:bold; }
.dashboard { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin:20px; }
.icon { background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.2); padding:20px; width:150px; text-align:center; cursor:pointer; transition:.3s; }
.icon:hover { background:#3498db; color:#fff; }
.icon span { font-size:40px; display:block; }
section { margin:20px; background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); display:none; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
table, th, td { border:1px solid #ccc; }
th, td { padding:8px; text-align:center; }
button { padding:6px 12px; margin:2px; border:none; border-radius:6px; cursor:pointer; }
.edit { background:#f39c12; color:#fff; }
.delete { background:#e74c3c; color:#fff; }
.save { background:#27ae60; color:#fff; }
.balanceBox { display:flex; gap:20px; justify-content:center; margin:20px; }
.balanceCard { background:#fff; padding:15px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-align:center; width:150px; }
input, select { padding:6px; margin:4px; width:150px; }
.accountList button { margin:3px; background:#3498db; color:white; }
</style>
</head>
<body>

<header>üìä My Accounting Pro</header>

<div class="dashboard" id="dashboard">
  <div class="icon" onclick="showSection('addTransaction')"><span>‚ûï</span>Add Transaction</div>
  <div class="icon" onclick="showSection('ledger')"><span>üìí</span>Ledger</div>
  <div class="icon" onclick="showSection('journal')"><span>üìù</span>Journal</div>
  <div class="icon" onclick="showSection('allTransactions')"><span>üìÇ</span>All Transactions</div>
  <div class="icon" onclick="downloadPDF('all')"><span>üìë</span>Download PDF</div>
</div>

<div class="balanceBox">
  <div class="balanceCard"><h3>Cash</h3><p id="cashBalance">0</p></div>
  <div class="balanceCard"><h3>Bank</h3><p id="bankBalance">0</p></div>
  <div class="balanceCard"><h3>eSewa</h3><p id="esewaBalance">0</p></div>
  <div class="balanceCard"><h3>Total</h3><p id="totalBalance">0</p></div>
</div>

<!-- Add Transaction -->
<section id="addTransaction">
  <h2>Add Transaction</h2>
  <input list="namesList" id="tname" placeholder="Name">
  <datalist id="namesList"></datalist>
  <input type="number" id="tamount" placeholder="Amount">
  <select id="ttype">
    <option value="Cash">Cash</option>
    <option value="Bank">Bank</option>
    <option value="eSewa">eSewa</option>
  </select>
  <select id="ttCategory">
    <option value="Income">Income</option>
    <option value="Expense">Expense</option>
  </select>
  <input type="text" id="tdesc" placeholder="Description">
  <input type="date" id="tdate">
  <button class="save" onclick="addTransaction()">Save</button>
  <button onclick="showSection('dashboard')">‚¨Ö Back</button>
</section>

<!-- Ledger -->
<section id="ledger">
  <h2>Ledger</h2>
  <input type="text" id="searchLedger" placeholder="Search by Name">
  <input type="date" id="searchLedgerDate">
  <button onclick="filterLedger()">Search</button>
  <button onclick="downloadLedgerPDF()">Download PDF</button>
  <h3>Accounts</h3>
  <div id="accountList" class="accountList"></div>
  <h3>Transactions</h3>
  <div id="ledgerData"></div>
  <button onclick="showSection('dashboard')">‚¨Ö Back</button>
</section>

<!-- Journal -->
<section id="journal">
  <h2>Journal</h2>
  <div id="journalData"></div>
  <button onclick="showSection('dashboard')">‚¨Ö Back</button>
</section>

<!-- All Transactions -->
<section id="allTransactions">
  <h2>All Transactions</h2>
  <div id="allData"></div>
  <button onclick="showSection('dashboard')">‚¨Ö Back</button>
</section>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDEwEKdRLKBbsw9GS_V3j0tzRlv4XjOHaA",
  authDomain: "personaldashboard-a6738.firebaseapp.com",
  databaseURL: "https://personaldashboard-a6738-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "personaldashboard-a6738",
  storageBucket: "personaldashboard-a6738.firebasestorage.app",
  messagingSenderId: "936129174674",
  appId: "1:936129174674:web:71dcc2cb9c590a3f361a4b",
  measurementId: "G-85JJGPJ7K4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let ledgerData = {};
let selectedAccount = "";

// Show sections
function showSection(id){
  document.querySelectorAll('section').forEach(s=>s.style.display='none');
  if(id==='dashboard'){ document.getElementById('dashboard').style.display='flex'; }
  else{ document.getElementById('dashboard').style.display='none'; document.getElementById(id).style.display='block'; }
}

// Load all transactions in real-time
db.ref('transactions').on('value', snap=>{
  ledgerData = snap.val()||{};
  updateNamesList();
  renderAccounts();
  renderJournal();
  renderAll();
  if(selectedAccount) showTransactions(selectedAccount);
  updateBalances();
});

// Add Transaction
function addTransaction(){
  const name=document.getElementById('tname').value;
  const amount=parseFloat(document.getElementById('tamount').value);
  const type=document.getElementById('ttype').value;
  const category=document.getElementById('ttCategory').value;
  const desc=document.getElementById('tdesc').value;
  const date=document.getElementById('tdate').value || new Date().toISOString().slice(0,10);
  if(!name || !amount){ alert('Fill all fields'); return; }
  const newRef=db.ref('transactions').push();
  newRef.set({id:newRef.key,name,amount,type,category,desc,date});
  document.getElementById('tname').value=''; 
  document.getElementById('tamount').value=''; 
  document.getElementById('tdesc').value=''; 
  document.getElementById('tdate').value='';
}

// Auto-suggest account names
function updateNamesList(){
  let names = Object.values(ledgerData).map(t=>t.name);
  let unique = [...new Set(names)];
  let list = document.getElementById('namesList');
  list.innerHTML = '';
  unique.forEach(n=>{ let opt=document.createElement('option'); opt.value=n; list.appendChild(opt); });
}

// Ledger accounts
function renderAccounts(){
  let accs = Object.values(ledgerData).map(t=>t.name);
  let unique = [...new Set(accs)];
  let html = '';
  unique.forEach(n=>{
    html+=`<button onclick="showTransactions('${n}')">${n}</button>`;
  });
  document.getElementById('accountList').innerHTML=html;
}

// Show transactions of selected account
function showTransactions(name){
  selectedAccount = name;
  let html="<table><tr><th>Date</th><th>Name</th><th>Amount</th><th>Type</th><th>Category</th><th>Description</th></tr>";
  Object.values(ledgerData).forEach(t=>{
    if(t.name===name){
      html+=`<tr><td>${t.date}</td><td>${t.name}</td><td>${t.amount}</td><td>${t.type}</td><td>${t.category}</td><td>${t.desc}</td></tr>`;
    }
  });
  html+="</table>";
  document.getElementById('ledgerData').innerHTML=html;
}

// Filter Ledger
function filterLedger(){
  let name=document.getElementById('searchLedger').value;
  let date=document.getElementById('searchLedgerDate').value;
  let html="<table><tr><th>Date</th><th>Name</th><th>Amount</th><th>Type</th><th>Category</th><th>Description</th></tr>";
  Object.values(ledgerData).forEach(t=>{
    if((!name || t.name.includes(name)) && (!date || t.date===date)){
      html+=`<tr><td>${t.date}</td><td>${t.name}</td><td>${t.amount}</td><td>${t.type}</td><td>${t.category}</td><td>${t.desc}</td></tr>`;
    }
  });
  html+="</table>";
  document.getElementById('ledgerData').innerHTML=html;
}

// Render Journal
function renderJournal(){
  let html="<table><tr><th>Date</th><th>Name</th><th>Amount</th><th>Type</th><th>Category</th><th>Description</th></tr>";
  Object.values(ledgerData).sort((a,b)=>new Date(a.date)-new Date(b.date)).forEach(t=>{
    html+=`<tr><td>${t.date}</td><td>${t.name}</td><td>${t.amount}</td><td>${t.type}</td><td>${t.category}</td><td>${t.desc}</td></tr>`;
  });
  html+="</table>";
  document.getElementById('journalData').innerHTML=html;
}

// Render All Transactions
function renderAll(){
  let html="<table><tr><th>Date</th><th>Name</th><th>Amount</th><th>Type</th><th>Category</th><th>Description</th></tr>";
  Object.values(ledgerData).forEach(t=>{
    html+=`<tr><td>${t.date}</td><td>${t.name}</td><td>${t.amount}</td><td>${t.type}</td><td>${t.category}</td><td>${t.desc}</td></tr>`;
  });
  html+="</table>";
  document.getElementById('allData').innerHTML=html;
}

// Update balances
function updateBalances(){
  let cash=0, bank=0, esewa=0;
  Object.values(ledgerData).forEach(t=>{
    let amt = (t.category==='Income'? t.amount : -t.amount);
    if(t.type==='Cash') cash+=amt;
    else if(t.type==='Bank') bank+=amt;
    else if(t.type==='eSewa') esewa+=amt;
  });
  document.getElementById('cashBalance').innerText=cash;
  document.getElementById('bankBalance').innerText=bank;
  document.getElementById('esewaBalance').innerText=esewa;
  document.getElementById('totalBalance').innerText=cash+bank+esewa;
}

// Download Ledger PDF
function downloadLedgerPDF(){
  let { jsPDF } = window.jspdf;
  let doc = new jsPDF('p','pt','a4');
  let body = [];
  let remarks = prompt("Enter remarks for PDF:","");
  Object.values(ledgerData).forEach(t=>{
    if(!selectedAccount || t.name===selectedAccount){
      body.push([t.date,t.name,t.amount,t.type,t.category,t.desc]);
    }
  });
  doc.autoTable({
    head:[["Date","Name","Amount","Type","Category","Description"]],
    body:body,
    startY:60,
    styles:{ fontSize:10, cellPadding:5 },
    headStyles:{ fillColor:[41,128,185], textColor:255 }
  });
  if(remarks) doc.text("Remarks: "+remarks,40,40);
  doc.save(selectedAccount?`Ledger_${selectedAccount}.pdf`:'Ledger.pdf');
}
</script>

</body>
</html>
