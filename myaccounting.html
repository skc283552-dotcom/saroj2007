<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üìä My Accounting</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6f9;
    }
    header {
      background: #2c3e50;
      color: #fff;
      text-align: center;
      padding: 15px;
      font-size: 24px;
      font-weight: bold;
    }
    .dashboard {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin: 20px;
    }
    .icon {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      padding: 20px;
      width: 160px;
      text-align: center;
      cursor: pointer;
      transition: 0.3s;
    }
    .icon:hover {
      background: #3498db;
      color: #fff;
    }
    .icon span {
      font-size: 40px;
      display: block;
      margin-bottom: 8px;
    }
    section {
      margin: 20px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    button {
      padding: 6px 12px;
      margin: 2px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .edit { background: #f39c12; color: #fff; }
    .delete { background: #e74c3c; color: #fff; }
    .save { background: #27ae60; color: #fff; }
    .balanceBox {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin: 20px;
    }
    .balanceCard {
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: center;
      width: 150px;
    }
  </style>
</head>
<body>
  <header>üìä My Accounting</header>

  <div class="dashboard">
    <div class="icon" onclick="showSection('addTransaction')"><span>‚ûï</span>Add Transaction</div>
    <div class="icon" onclick="showSection('ledger')"><span>üìí</span>Ledger</div>
    <div class="icon" onclick="showSection('journal')"><span>üìù</span>Journal</div>
    <div class="icon" onclick="showSection('allTransactions')"><span>üìÇ</span>All Transactions</div>
    <div class="icon" onclick="downloadPDF()"><span>üìë</span>Download PDF</div>
  </div>

  <div class="balanceBox">
    <div class="balanceCard"><h3>üíµ Cash</h3><p id="cashBalance">0</p></div>
    <div class="balanceCard"><h3>üè¶ Bank</h3><p id="bankBalance">0</p></div>
    <div class="balanceCard"><h3>üì± eSewa</h3><p id="esewaBalance">0</p></div>
    <div class="balanceCard"><h3>üí∞ Total</h3><p id="totalBalance">0</p></div>
  </div>

  <!-- Add Transaction -->
  <section id="addTransaction">
    <h2>Add Transaction</h2>
    <input type="text" id="tname" placeholder="Name">
    <input type="number" id="tamount" placeholder="Amount">
    <select id="ttype">
      <option value="Cash">Cash</option>
      <option value="Bank">Bank</option>
      <option value="eSewa">eSewa</option>
    </select>
    <input type="text" id="tdesc" placeholder="Description">
    <button class="save" onclick="addTransaction()">Save</button>
  </section>

  <!-- Ledger -->
  <section id="ledger">
    <h2>Ledger</h2>
    <input type="text" id="searchLedger" placeholder="Search by Name">
    <button onclick="searchLedgerFn()">Search</button>
    <div id="ledgerData"></div>
  </section>

  <!-- Journal -->
  <section id="journal">
    <h2>Journal</h2>
    <div id="journalData"></div>
  </section>

  <!-- All Transactions -->
  <section id="allTransactions">
    <h2>All Transactions</h2>
    <div id="allData"></div>
  </section>

<script>
  // ‚úÖ Firebase Config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function showSection(id) {
    document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
    document.getElementById(id).style.display = 'block';
  }

  // ‚úÖ Add Transaction
  function addTransaction(){
    let name = document.getElementById("tname").value;
    let amount = parseFloat(document.getElementById("tamount").value);
    let type = document.getElementById("ttype").value;
    let desc = document.getElementById("tdesc").value;

    if(!name || !amount){ alert("Fill all fields"); return; }

    let newRef = db.ref("transactions").push();
    newRef.set({ id:newRef.key, name, amount, type, desc, date: new Date().toLocaleString() });

    alert("‚úÖ Transaction Added");
    document.getElementById("tname").value="";
    document.getElementById("tamount").value="";
    document.getElementById("tdesc").value="";
  }

  // ‚úÖ Display Data
  db.ref("transactions").on("value", snapshot => {
    let data = snapshot.val();
    let ledgerHTML = "<table><tr><th>Name</th><th>Amount</th><th>Type</th><th>Description</th><th>Date</th><th>Action</th></tr>";
    let journalHTML = "<table><tr><th>Name</th><th>Description</th><th>Date</th></tr>";
    let allHTML = ledgerHTML;

    let cash=0, bank=0, esewa=0;

    for(let id in data){
      let t = data[id];
      ledgerHTML += `<tr><td>${t.name}</td><td>${t.amount}</td><td>${t.type}</td><td>${t.desc}</td><td>${t.date}</td>
        <td><button class='edit' onclick="editTransaction('${id}', ${t.amount})">Edit</button>
        <button class='delete' onclick="deleteTransaction('${id}')">Delete</button></td></tr>`;

      journalHTML += `<tr><td>${t.name}</td><td>${t.desc}</td><td>${t.date}</td></tr>`;

      allHTML += `<tr><td>${t.name}</td><td>${t.amount}</td><td>${t.type}</td><td>${t.desc}</td><td>${t.date}</td>
        <td><button class='edit' onclick="editTransaction('${id}', ${t.amount})">Edit</button>
        <button class='delete' onclick="deleteTransaction('${id}')">Delete</button></td></tr>`;

      if(t.type=="Cash") cash+=t.amount;
      if(t.type=="Bank") bank+=t.amount;
      if(t.type=="eSewa") esewa+=t.amount;
    }

    ledgerHTML += "</table>";
    journalHTML += "</table>";
    allHTML += "</table>";

    document.getElementById("ledgerData").innerHTML = ledgerHTML;
    document.getElementById("journalData").innerHTML = journalHTML;
    document.getElementById("allData").innerHTML = allHTML;

    document.getElementById("cashBalance").innerText = cash;
    document.getElementById("bankBalance").innerText = bank;
    document.getElementById("esewaBalance").innerText = esewa;
    document.getElementById("totalBalance").innerText = cash+bank+esewa;
  });

  // ‚úÖ Delete
  function deleteTransaction(id){
    if(confirm("Delete this record?")){
      db.ref("transactions/"+id).remove();
    }
  }

  // ‚úÖ Edit
  function editTransaction(id, oldAmount){
    let newAmount = prompt("Enter new amount", oldAmount);
    if(newAmount){ db.ref("transactions/"+id).update({ amount: parseFloat(newAmount) }); }
  }

  // ‚úÖ Search Ledger
  function searchLedgerFn(){
    let name = document.getElementById("searchLedger").value.toLowerCase();
    db.ref("transactions").once("value", snapshot => {
      let data = snapshot.val();
      let ledgerHTML = "<table><tr><th>Name</th><th>Amount</th><th>Type</th><th>Description</th><th>Date</th></tr>";
      for(let id in data){
        let t = data[id];
        if(t.name.toLowerCase().includes(name)){
          ledgerHTML += `<tr><td>${t.name}</td><td>${t.amount}</td><td>${t.type}</td><td>${t.desc}</td><td>${t.date}</td></tr>`;
        }
      }
      ledgerHTML += "</table>";
      document.getElementById("ledgerData").innerHTML = ledgerHTML;
    });
  }

  // ‚úÖ PDF Download
  function downloadPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("üìä My Accounting Transactions", 20, 20);
    let y = 30;
    db.ref("transactions").once("value", snapshot => {
      let data = snapshot.val();
      for(let id in data){
        let t = data[id];
        doc.text(`${t.date} | ${t.name} | Rs.${t.amount} | ${t.type} | ${t.desc}`, 20, y);
        y+=10;
      }
      doc.save("transactions.pdf");
    });
  }
</script>
</body>
</html>
