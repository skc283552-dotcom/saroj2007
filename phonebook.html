<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phone Book</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
body{font-family:'Roboto',sans-serif;margin:0;padding:0;background:#e1f5fe;}
header{background:#0288d1;color:white;padding:20px;text-align:center;}
.section{width:90%;margin:20px auto;background:white;padding:15px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
input,button{padding:8px;margin:5px;border-radius:5px;border:1px solid #ccc;}
button{border:none;background:#4e73df;color:white;cursor:pointer;}
button.delete{background:#e74c3c;}
button.edit{background:#f39c12;}
table{width:100%;border-collapse:collapse;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
th{background:#03a9f4;color:white;}
img{width:50px;height:50px;border-radius:6px;}
</style>
</head>
<body>

<header><h1>Phone Book</h1></header>

<!-- IMPORT VCF -->
<div class="section">
<h3>Import Contacts (VCF File)</h3>
<input type="file" id="vcfFile" accept=".vcf">
<button onclick="importVCF()">Import VCF</button>
</div>

<!-- ADD CONTACT -->
<div class="section">
<h3>Add Contact</h3>
<input type="text" id="contactName" placeholder="Name">
<input type="text" id="contactPhone" placeholder="Phone Number">
<input type="text" id="contactPhoto" placeholder="Photo URL">
<button onclick="addContact()">Add</button>
</div>

<!-- SEARCH -->
<div class="section">
<h3>Search Contact</h3>
<input type="text" id="searchName" placeholder="Search by Name" onkeyup="searchContacts()">
</div>

<!-- CONTACT TABLE -->
<div class="section">
<h3>Contacts</h3>
<table id="contactTable">
<tr><th>Photo</th><th>Name</th><th>Phone Number</th><th>Actions</th></tr>
</table>
</div>

<div style="text-align:center;margin:20px;">
<button onclick="window.location.href='index.html'">Back to Dashboard</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDEwEKdRLKBbsw9GS_V3j0tzRlv4XjOHaA",
  authDomain: "personaldashboard-a6738.firebaseapp.com",
  databaseURL: "https://personaldashboard-a6738-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "personaldashboard-a6738",
  storageBucket: "personaldashboard-a6738.appspot.com",
  messagingSenderId: "936129174674",
  appId: "1:936129174674:web:71dcc2cb9c590a3f361a4b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref("phonebook");


// ADD CONTACT
function addContact(){
  const name=document.getElementById('contactName').value.trim();
  const phone=document.getElementById('contactPhone').value.trim();
  const photo=document.getElementById('contactPhoto').value.trim() || "https://via.placeholder.com/50";

  if(!name || !phone){
    alert("Name and Phone required");
    return;
  }

  const id=Date.now();
  db.child(id).set({name,phone,photo});

  document.getElementById('contactName').value='';
  document.getElementById('contactPhone').value='';
  document.getElementById('contactPhoto').value='';
}


// IMPORT VCF
function importVCF(){
  const fileInput=document.getElementById("vcfFile");
  const file=fileInput.files[0];

  if(!file){
    alert("Select a VCF file");
    return;
  }

  const reader=new FileReader();
  reader.onload=function(e){
    const text=e.target.result;
    const contacts=text.split("END:VCARD");

    contacts.forEach(contact=>{
      const nameMatch=contact.match(/FN:(.*)/);
      const phoneMatch=contact.match(/TEL[^:]*:(.*)/);

      if(nameMatch && phoneMatch){
        const name=nameMatch[1].trim();
        const phone=phoneMatch[1].trim();

        const id=Date.now()+Math.random();
        db.child(id).set({
          name:name,
          phone:phone,
          photo:"https://via.placeholder.com/50"
        });
      }
    });

    alert("VCF Imported Successfully!");
    fileInput.value="";
  };

  reader.readAsText(file);
}


// LOAD CONTACTS
db.on('value', snapshot=>{
  const data=snapshot.val() || {};
  displayContacts(data);
});


// DISPLAY CONTACTS
function displayContacts(data){
  const table=document.getElementById('contactTable');
  table.innerHTML="<tr><th>Photo</th><th>Name</th><th>Phone Number</th><th>Actions</th></tr>";

  for(let key in data){
    let row=table.insertRow();
    row.insertCell(0).innerHTML=`<img src="${data[key].photo}">`;
    row.insertCell(1).innerText=data[key].name;
    row.insertCell(2).innerText=data[key].phone;
    row.insertCell(3).innerHTML=`
      <button class="edit" onclick="editContact('${key}')">Edit</button>
      <button class="delete" onclick="deleteContact('${key}')">Delete</button>`;
  }
}


// DELETE
function deleteContact(id){
  if(confirm("Delete this contact?")){
    db.child(id).remove();
  }
}


// EDIT
function editContact(id){
  db.child(id).once('value',snap=>{
    const data=snap.val();

    const newName=prompt("Edit Name:", data.name);
    const newPhone=prompt("Edit Phone:", data.phone);
    const newPhoto=prompt("Edit Photo URL:", data.photo);

    if(newName && newPhone){
      db.child(id).update({
        name:newName,
        phone:newPhone,
        photo:newPhoto || "https://via.placeholder.com/50"
      });
    }
  });
}


// SEARCH
function searchContacts(){
  const filter=document.getElementById('searchName').value.toLowerCase();

  db.once('value', snapshot=>{
    const data=snapshot.val() || {};
    let filtered={};

    for(let key in data){
      if(data[key].name.toLowerCase().includes(filter)){
        filtered[key]=data[key];
      }
    }

    displayContacts(filtered);
  });
}

</script>
</body>
</html>

