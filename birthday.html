<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<style>
body{font-family:'Roboto',sans-serif;background:#f3e5f5;margin:0;padding:0;}
header{background:#7b1fa2;color:white;text-align:center;padding:20px;}
.section{width:90%;margin:20px auto;background:white;padding:15px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.2);}
input,button{padding:8px;margin:5px;border-radius:5px;border:1px solid #ccc;}
button{cursor:pointer;border:none;}
.add-btn{background:#4caf50;color:white;}
.update-btn{background:#ff9800;color:white;}
.delete-btn{background:#f44336;color:white;}
.edit-btn{background:#2196f3;color:white;}
.download-btn{background:#7b1fa2;color:white;padding:10px 20px;margin:10px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
th{background:#7b1fa2;color:white;}
</style>
</head>
<body>
<header><h1>ðŸŽ‚ Birthday Manager</h1></header>

<div class="section">
  <h3 id="formTitle">Add Birthday</h3>
  <input type="text" id="bName" placeholder="Name">
  <input type="date" id="bDate">
  <input type="text" id="bPhone" placeholder="Phone Number">
  <input type="text" id="bNotes" placeholder="Notes / Relation">
  <button class="add-btn" onclick="addBirthday()">Save</button>
  <button class="update-btn" onclick="updateBirthday()" style="display:none;">Update</button>
</div>

<div class="section">
  <h3>Search</h3>
  <input type="text" id="searchInput" placeholder="Search by name or phone" onkeyup="searchBirthdays()">
</div>

<div class="section">
  <h3>All Birthdays</h3>
  <table id="birthdayTable">
    <tr><th>S.N</th><th>Name</th><th>Date of Birth</th><th>Phone</th><th>Notes</th><th>Actions</th></tr>
  </table>
  <button class="download-btn" onclick="downloadPDF()">ðŸ“„ Download PDF</button>
</div>

<div style="text-align:center;margin:20px;">
  <button onclick="window.location.href='index.html'">â¬… Back to Dashboard</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDEwEKdRLKBbsw9GS_V3j0tzRlv4XjOHaA",
  authDomain: "personaldashboard-a6738.firebaseapp.com",
  databaseURL: "https://personaldashboard-a6738-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "personaldashboard-a6738",
  storageBucket: "personaldashboard-a6738.appspot.com",
  messagingSenderId: "936129174674",
  appId: "1:936129174674:web:71dcc2cb9c590a3f361a4b",
  measurementId: "G-85JJGPJ7K4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref("birthdays");

let editId = null;

// Add Birthday
function addBirthday(){
  const name=document.getElementById('bName').value;
  const date=document.getElementById('bDate').value;
  const phone=document.getElementById('bPhone').value;
  const notes=document.getElementById('bNotes').value;
  if(!name || !date || !phone) return alert("Fill all required fields!");
  const id=Date.now();
  db.child(id).set({name,date,phone,notes});
  clearForm();
}

// Load Birthdays
db.on('value', snapshot=>{
  const data=snapshot.val();
  displayBirthdays(data);
});

// Display
function displayBirthdays(data){
  const table=document.getElementById('birthdayTable');
  table.innerHTML="<tr><th>S.N</th><th>Name</th><th>Date of Birth</th><th>Phone</th><th>Notes</th><th>Actions</th></tr>";
  let i=1;
  for(let key in data){
    let row=table.insertRow();
    row.insertCell(0).innerText=i++;
    row.insertCell(1).innerText=data[key].name;
    row.insertCell(2).innerText=data[key].date;
    row.insertCell(3).innerText=data[key].phone;
    row.insertCell(4).innerText=data[key].notes || "";
    row.insertCell(5).innerHTML=
      `<button class='edit-btn' onclick="editBirthday('${key}','${data[key].name}','${data[key].date}','${data[key].phone}','${data[key].notes || ""}')">Edit</button>
       <button class='delete-btn' onclick="deleteBirthday('${key}')">Delete</button>`;
  }
}

// Edit
function editBirthday(id,name,date,phone,notes){
  editId=id;
  document.getElementById('bName').value=name;
  document.getElementById('bDate').value=date;
  document.getElementById('bPhone').value=phone;
  document.getElementById('bNotes').value=notes;
  document.querySelector('.add-btn').style.display="none";
  document.querySelector('.update-btn').style.display="inline-block";
  document.getElementById('formTitle').innerText="Edit Birthday";
}

// Update
function updateBirthday(){
  const name=document.getElementById('bName').value;
  const date=document.getElementById('bDate').value;
  const phone=document.getElementById('bPhone').value;
  const notes=document.getElementById('bNotes').value;
  if(editId){
    db.child(editId).update({name,date,phone,notes});
    clearForm();
  }
}

// Delete
function deleteBirthday(id){
  if(confirm("Delete this entry?")){
    db.child(id).remove();
  }
}

// Clear Form
function clearForm(){
  document.getElementById('bName').value="";
  document.getElementById('bDate').value="";
  document.getElementById('bPhone').value="";
  document.getElementById('bNotes').value="";
  document.querySelector('.add-btn').style.display="inline-block";
  document.querySelector('.update-btn').style.display="none";
  document.getElementById('formTitle').innerText="Add Birthday";
  editId=null;
}

// Search
function searchBirthdays(){
  const filter=document.getElementById('searchInput').value.toLowerCase();
  db.once('value', snapshot=>{
    const data=snapshot.val();
    let filtered={};
    for(let key in data){
      if(data[key].name.toLowerCase().includes(filter) || data[key].phone.includes(filter)){
        filtered[key]=data[key];
      }
    }
    displayBirthdays(filtered);
  });
}

// Download PDF
function downloadPDF(){
  db.once('value', snapshot=>{
    const data=snapshot.val();
    if(!data) return alert("No data to download");
    const rows=[];
    let i=1;
    for(let key in data){
      rows.push([i++, data[key].name, data[key].date, data[key].phone, data[key].notes||""]);
    }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Birthday List", 14, 15);
    doc.autoTable({head:[["S.N","Name","Date of Birth","Phone","Notes"]], body:rows, startY:20});
    doc.save("birthdays.pdf");
  });
}
</script>
</body>
</html>
